<template>
    <lightning-card title="Casos Activos">
        <div class="slds-p-around_medium">

            <lightning-layout horizontal-align="spread">
                <lightning-layout-item flexibility="auto" padding="around-small">
                    <lightning-button label="Exportar Excel" onclick={handleExport} icon-name="doctype:excel" class="slds-m-left-small"></lightning-button>
                </lightning-layout-item>

                <lightning-layout-item flexibility="auto" padding="around-small">
                    <lightning-button label="Limpiar Filtros" onclick={clearFilters} icon-name="standard:filter" class="slds-m-left-small"></lightning-button>
                </lightning-layout-item>
            </lightning-layout > 

            <!--Controles de Filtro-->
            <lightning-layout class="filter-bar">

                <lightning-layout-item flexibility="auto" padding="around-small">
                    <lightning-input label="No. de Caso" name="selectedCaseNumber" value={selectedCaseNumber} onchange={handleFilterChange} placeholder="Digite el No. de Caso" data-field="CaseNumber"></lightning-input>
                </lightning-layout-item>
                
                <lightning-layout-item flexibility="auto" padding="around-small">
                    <lightning-input label="Asunto" name="selectedNombreTicket" value={selectedNombreTicket} onchange={handleFilterChange} placeholder="Digite el Asunto" data-field="Subject"></lightning-input>
                </lightning-layout-item>

                <lightning-layout-item flexibility="auto" padding="around-small">
                    <lightning-combobox label="Estado" name="selectedEstado" value={selectedEstado} options={estadoOptions} onchange={handleFilterChange} placeholder="Seleccione el Estado" data-field="cc_ap_Estados__c"></lightning-combobox>
                </lightning-layout-item>

                <lightning-layout-item flexibility="auto" padding="around-small">
                    <lightning-combobox label="Servicio" name="selectedSubUnidad" value={selectedSubUnidad} options={subUnidadOptions} onchange={handleFilterChange} placeholder="Seleccione el servicio" data-field="cc_ap_Sub_rea_del_Requerimiento__c"></lightning-combobox>
                </lightning-layout-item>

                <lightning-layout-item flexibility="auto" padding="around-small">
                    <lightning-input label="Paciente" name="selectedNombrePaciente" value={selectedNombrePaciente} onchange={handleFilterChange} placeholder="Digite el Nombre del Paciente" data-field="Nombre_Completo_Chile__c"></lightning-input>
                </lightning-layout-item>

                <lightning-layout-item flexibility="auto" padding="around-small">
                    <lightning-combobox label="Alta Complejidad" name="selectedAltaComplejidad" value={selectedAltaComplejidad} options={altaComplejidadOptions} onchange={handleFilterChange} placeholder="Seleccione complejidad" data-field="cc_ap_AC__c"></lightning-combobox>
                </lightning-layout-item>

                <lightning-layout-item flexibility="auto" padding="around-small">
                    <lightning-input type="date" label="Fecha Desde" name="selectedFechaInicioDesde" value={selectedFechaInicioDesde} onchange={handleFilterChange} placeholder="Seleccione la Fecha" data-field="startDate"></lightning-input>
                </lightning-layout-item>

                <lightning-layout-item flexibility="auto" padding="around-small">
                    <lightning-input type="date" label="Fecha Hasta" name="selectedFechaInicioHasta" value={selectedFechaInicioHasta} onchange={handleFilterChange} placeholder="Seleccione la Fecha" data-field="endDate"></lightning-input>
                </lightning-layout-item>
                
            </lightning-layout>

        </div>
        <template if:true={filteredCases}>
            <lightning-datatable
                data={filteredCases}
                columns={columns}
                key-field="Id"
                sorted-by={sortBy}
                sorted-direction={sortDirection}
                onsort={handleSort}>
            </lightning-datatable>
        </template>
        <template if:true={error}>
            <div class="slds-box slds-theme_alert-texture slds-theme_alert slds-theme_error">
                <p>{error.body.message}</p>
            </div>
            
        </template>
    </lightning-card>
</template>