<template>
  <lightning-card title="Solicitudes de Mejora">
    <div class="slds-p-around_medium">
      <lightning-layout horizontal-align="spread">
        <lightning-layout-item flexibility="auto" padding="around-small">
          <lightning-button
            label="Exportar Excel"
            onclick={handleExport}
            icon-name="doctype:excel"
            class="slds-m-left-small"
          ></lightning-button>
        </lightning-layout-item>

        <lightning-layout-item flexibility="auto" padding="around-small">
          <lightning-button
            label="Limpiar Filtros"
            onclick={clearFilters}
            icon-name="standard:filter"
            class="slds-m-left-small"
          ></lightning-button>
        </lightning-layout-item>
      </lightning-layout>

      <!--Controles de Filtro-->
      <lightning-layout class="filter-bar">
        <lightning-layout-item flexibility="auto" padding="around-small">
          <lightning-input
            label="No. de solicitud"
            name="selectedNumeroSolicitud"
            value={selectedNumeroSolicitud}
            onchange={handleFilterChange}
            placeholder="Digite el No. de solicitud"
            data-field="Name"
          ></lightning-input>
        </lightning-layout-item>

        <lightning-layout-item flexibility="auto" padding="around-small">
          <lightning-input
            label="Asunto"
            name="selectedAsunto"
            value={selectedAsunto}
            onchange={handleFilterChange}
            placeholder="Digite el Asunto"
            data-field="Titulo__c"
          ></lightning-input>
        </lightning-layout-item>

        <lightning-layout-item flexibility="auto" padding="around-small">
          <lightning-combobox
            label="Categoria"
            name="selectedCategoria"
            value={selectedCategoria}
            options={CategoriaOptions}
            onchange={handleFilterChange}
            placeholder="Seleccione la categorÃ­a"
            data-field="Categoria_de_Mejora__c"
          ></lightning-combobox>
        </lightning-layout-item>

        <lightning-layout-item flexibility="auto" padding="around-small">
          <lightning-combobox
            label="Estado"
            name="selectedEstado"
            value={selectedEstado}
            options={EstadoOptions}
            onchange={handleFilterChange}
            placeholder="Seleccione el Estado"
            data-field="Estado__c"
          ></lightning-combobox>
        </lightning-layout-item>

        <lightning-layout-item flexibility="auto" padding="around-small">
          <lightning-input
            type="date"
            label="Fecha Desde"
            name="selectedFechadeingresoDesde"
            value={selectedFechadeingresoDesde}
            onchange={handleFilterChange}
            placeholder="Seleccione la Fecha"
            data-field="startDate"
          ></lightning-input>
        </lightning-layout-item>

        <lightning-layout-item flexibility="auto" padding="around-small">
          <lightning-input
            type="date"
            label="Fecha Hasta"
            name="selectedFechadeingresoHasta"
            value={selectedFechadeingresoHasta}
            onchange={handleFilterChange}
            placeholder="Seleccione la Fecha"
            data-field="endDate"
          ></lightning-input>
        </lightning-layout-item>
      </lightning-layout>
    </div>
    <template if:true={filteredSolicitudes}>
      <lightning-datatable
        data={filteredSolicitudes}
        columns={columns}
        key-field="Id"
        sorted-by={sortBy}
        sorted-direction={sortDirection}
        onsort={handleSort}
      >
      </lightning-datatable>
    </template>
    <template if:true={error}>
      <div
        class="slds-box slds-theme_alert-texture slds-theme_alert slds-theme_error"
      >
        <p>{error.body.message}</p>
      </div>
    </template>
  </lightning-card>
</template>